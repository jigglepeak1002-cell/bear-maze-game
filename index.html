<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Bear Maze â€“ Mobile Hardcore</title>

<style>
* {
  box-sizing: border-box;
  touch-action: none;
}

body {
  margin: 0;
  background: #000;
  font-family: sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

#game {
  width: 100%;
  max-width: 420px;
  text-align: center;
}

#canvasWrapper {
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1;
  overflow: hidden;
  border-radius: 12px;
}

#bg {
  position: absolute;
  inset: 0;
  background: url("assets/jungle.png") center/cover no-repeat;
  filter: blur(2px);
  z-index: 0;
}

canvas {
  position: absolute;
  inset: 0;
  z-index: 1;
}

/* Touch Controls */
#controls {
  margin-top: 14px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#controls button {
  width: 64px;
  height: 64px;
  margin: 6px;
  font-size: 28px;
  border: none;
  border-radius: 12px;
  background: #222;
  color: #fff;
}

#controls button:active {
  background: #555;
}

.row {
  display: flex;
}
</style>
</head>

<body>

<div id="game">

  <div id="canvasWrapper">
    <div id="bg"></div>
    <canvas id="canvas"></canvas>
  </div>

  <div id="controls">
    <button ontouchstart="move(0,-1)">â¬†</button>
    <div class="row">
      <button ontouchstart="move(-1,0)">â¬…</button>
      <button ontouchstart="move(0,1)">â¬‡</button>
      <button ontouchstart="move(1,0)">âž¡</button>
    </div>
  </div>

</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  const size = document.getElementById("canvasWrapper").clientWidth;
  canvas.width = size;
  canvas.height = size;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* ---------------- GAME CONFIG ---------------- */
const GRID = 21;               // hardcore maze size
const TILE = () => canvas.width / GRID;
const BEAR_SIZE = () => TILE() * 1.3;
const MOTHER_SIZE = () => TILE() * 1.5;
const SAFE_RADIUS = 3;

/* ---------------- MAZE ---------------- */
let maze = Array.from({ length: GRID }, () => Array(GRID).fill(1));

function carve(x, y) {
  maze[y][x] = 0;
  const dirs = [[2,0],[-2,0],[0,2],[0,-2]].sort(() => Math.random() - 0.5);

  for (const [dx, dy] of dirs) {
    const nx = x + dx;
    const ny = y + dy;
    if (nx > 0 && ny > 0 && nx < GRID-1 && ny < GRID-1 && maze[ny][nx] === 1) {
      maze[y + dy/2][x + dx/2] = 0;
      carve(nx, ny);
    }
  }
}

carve(1,1);

/* Obstacles only in dead ends, not near start/end */
function dist(x,y,a,b){ return Math.abs(x-a)+Math.abs(y-b); }

for (let y=1;y<GRID-1;y++){
  for (let x=1;x<GRID-1;x++){
    if (maze[y][x]===0){
      let open=0;
      [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dx,dy])=>{
        if(maze[y+dy][x+dx]===0) open++;
      });
      if(open===1 &&
         dist(x,y,1,1)>SAFE_RADIUS &&
         dist(x,y,GRID-2,GRID-2)>SAFE_RADIUS &&
         Math.random()<0.75){
        maze[y][x]=2;
      }
    }
  }
}

maze[1][1]=0;
maze[GRID-2][GRID-2]=0;

/* ---------------- PLAYER ---------------- */
const player={x:1,y:1};
const mother={x:GRID-2,y:GRID-2};

const bearImg=new Image();
bearImg.src="assets/bear.png";
const motherImg=new Image();
motherImg.src="assets/mother.png";

/* ---------------- DRAW ---------------- */
function drawMaze(){
  for(let y=0;y<GRID;y++){
    for(let x=0;x<GRID;x++){
      if(maze[y][x]===1){
        ctx.fillStyle="#111";
        ctx.fillRect(x*TILE(),y*TILE(),TILE(),TILE());
      }
      if(maze[y][x]===2){
        ctx.fillStyle="#d00000";
        ctx.beginPath();
        ctx.arc(
          x*TILE()+TILE()/2,
          y*TILE()+TILE()/2,
          TILE()/4,
          0,Math.PI*2
        );
        ctx.fill();
      }
    }
  }
}

function drawSprites(){
  ctx.drawImage(
    bearImg,
    player.x*TILE()-TILE()*0.15,
    player.y*TILE()-TILE()*0.15,
    BEAR_SIZE(),
    BEAR_SIZE()
  );
  ctx.drawImage(
    motherImg,
    mother.x*TILE()-TILE()*0.2,
    mother.y*TILE()-TILE()*0.2,
    MOTHER_SIZE(),
    MOTHER_SIZE()
  );
}

/* ---------------- MOVE ---------------- */
function move(dx,dy){
  const nx=player.x+dx;
  const ny=player.y+dy;
  const cell=maze[ny]?.[nx];
  if(cell===1||cell===undefined)return;
  if(cell===2){
    alert("ðŸ’¥ Wrong way! Try again.");
    location.reload();
    return;
  }
  player.x=nx;
  player.y=ny;
  if(nx===mother.x&&ny===mother.y){
    alert("ðŸ» You reached your mother!");
    location.reload();
    return;
  }
  render();
}

/* ---------------- RENDER ---------------- */
function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMaze();
  drawSprites();
}
render();
</script>

</body>
</html>
